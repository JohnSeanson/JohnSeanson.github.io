<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: "en" }}">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>{% if page.title %}{{ page.title }} | {% endif %}{{ site.title }}</title>

  <!-- SEO Meta tags -->
  {% include seo.html %}

  <!-- Stylesheets -->
  <link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}" />
  <link rel="stylesheet" href="{{ '/assets/css/custom.css' | relative_url }}" />

  <!-- Favicon, fonts, etc -->
  {% include head.html %}
</head>
<body class="{{ page.layout }}">

<nav role="navigation" class="site-nav">
  <a href="{{ '/' | relative_url }}" class="site-logo">{{ site.title }}</a>

  <ul class="nav-links">
    <li><a href="{{ '/posts/' | relative_url }}">Posts</a></li>
    <li><a href="{{ '/categories/' | relative_url }}">Categories</a></li>
    <li><a href="{{ '/tags/' | relative_url }}">Tags</a></li>
  </ul>

  <form action="{{ '/search/' | relative_url }}" method="get" class="nav-search">
    <input type="search" name="q" placeholder="Search…" aria-label="Search site" />
    <button type="submit" aria-label="Search">&#128269;</button>
  </form>
</nav>

  </header>

  <div class="site-main">
    {{ content }}
  </div>

  <footer role="contentinfo" class="site-footer">
    <div class="wrapper">
      <p>© {{ site.time | date: '%Y' }} {{ site.title }} — All rights reserved.</p>
    </div>
    <div id="dark-mode-toggle" style="text-align: right; font-size: 0.8rem; cursor: pointer; user-select: none; margin-top: 0.5em;">
    <span id="dark-mode-text">Light Mode</span>
    </div>
  </footer>

  <!-- Optional scripts -->
  {% include scripts.html %}
  <script>
  document.addEventListener('DOMContentLoaded', function () {
    const toggle = document.getElementById('dark-mode-toggle');
    const text = document.getElementById('dark-mode-text');

    if (!toggle || !text) {
      console.error('Dark mode toggle elements not found');
      return;
    }

    // On page load, check localStorage and set theme accordingly
    if (localStorage.getItem('theme') === 'dark') {
      document.body.classList.add('dark-mode');
      text.textContent = 'Dark Mode';
    } else {
      text.textContent = 'Light Mode';
    }

    toggle.addEventListener('click', () => {
      document.body.classList.toggle('dark-mode');

      if (document.body.classList.contains('dark-mode')) {
        localStorage.setItem('theme', 'dark');
        text.textContent = 'Dark Mode';
      } else {
        localStorage.setItem('theme', 'light');
        text.textContent = 'Light Mode';
      }
    });
  });
</script>
<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script>
<ul id="search-results"></ul>
  
<script>
  const searchInput = document.querySelector('.nav-search input');
  const resultsContainer = document.querySelector('#search-results');

  if (searchInput && resultsContainer) {
    SimpleJekyllSearch({
      searchInput: searchInput,
      resultsContainer: resultsContainer,
      json: '/search.json',
      searchResultTemplate: '<li><a href="{url}">{title}</a></li>',
      noResultsText: 'No results found',
      limit: 10,
      fuzzy: false
    });

    // Prevent form submission if inside a form tag
    if (searchInput.closest('form')) {
      searchInput.closest('form').addEventListener('submit', function (e) {
        e.preventDefault();
      });
    }
  }
</script>

</body>
</html>
