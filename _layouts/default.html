<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: "en" }}">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>{% if page.title %}{{ page.title }} | {% endif %}{{ site.title }}</title>

  <!-- SEO Meta tags -->
  {% include seo.html %}

  <!-- Stylesheets -->
  <link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}" />
  <link rel="stylesheet" href="{{ '/assets/css/custom.css' | relative_url }}" />

  <!-- Favicon, fonts, etc -->
  {% include head.html %}
</head>
<body class="{{ page.layout }}">

<nav role="navigation" class="site-nav">
  <a href="{{ '/' | relative_url }}" class="site-logo">{{ site.title }}</a>

  <ul class="nav-links">
    <li><a href="{{ '/posts/' | relative_url }}">Posts</a></li>
    <li><a href="{{ '/categories/' | relative_url }}">Categories</a></li>
    <li><a href="{{ '/tags/' | relative_url }}">Tags</a></li>
  </ul>

  <!-- Search Input (results container moved to bottom) -->
  <div class="nav-search" role="search" aria-label="Site search">
    <input type="search" id="search-input" placeholder="Search…" aria-label="Search site" autocomplete="off" />
  </div>
</nav>

<div class="site-main">
  {{ content }}
</div>

<footer role="contentinfo" class="site-footer">
  <div class="wrapper">
    <p>© {{ site.time | date: '%Y' }} {{ site.title }} — All rights reserved.</p>
  </div>
  <div id="dark-mode-toggle" style="text-align: right; font-size: 0.8rem; cursor: pointer; user-select: none; margin-top: 0.5em;">
    <span id="dark-mode-text">Light Mode</span>
  </div>
</footer>

<!-- Optional scripts -->
{% include scripts.html %}

<!-- Dark Mode Toggle Script -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const toggle = document.getElementById('dark-mode-toggle');
    const text = document.getElementById('dark-mode-text');

    if (!toggle || !text) {
      console.error('Dark mode toggle elements not found');
      return;
    }

    // On page load, check localStorage and set theme accordingly
    if (localStorage.getItem('theme') === 'dark') {
      document.body.classList.add('dark-mode');
      text.textContent = 'Dark Mode';
    } else {
      text.textContent = 'Light Mode';
    }

    toggle.addEventListener('click', () => {
      document.body.classList.toggle('dark-mode');

      if (document.body.classList.contains('dark-mode')) {
        localStorage.setItem('theme', 'dark');
        text.textContent = 'Dark Mode';
      } else {
        localStorage.setItem('theme', 'light');
        text.textContent = 'Light Mode';
      }
    });
  });
</script>

<!-- Simple-Jekyll-Search Script -->
<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script>

<!-- Search Results Container (now outside nav/header) -->
<ul id="search-results" aria-live="polite" aria-label="Search results"></ul>

<script>
  const searchInput = document.querySelector('#search-input');
  const resultsContainer = document.querySelector('#search-results');

  if (searchInput && resultsContainer) {
    SimpleJekyllSearch({
      searchInput: searchInput,
      resultsContainer: resultsContainer,
      json: '/search.json',
      searchResultTemplate: '<li><a href="{url}">{title}</a></li>',
      noResultsText: '<li>No results found</li>',
      limit: 10,
      fuzzy: false
    });

    searchInput.addEventListener('input', () => {
      const query = searchInput.value.trim();
      if (query.length > 0) {
        resultsContainer.classList.add('active');
        resultsContainer.style.display = 'block';
      } else {
        resultsContainer.classList.remove('active');
        resultsContainer.style.display = 'none';
      }
    });

    // Optional: hide panel on click outside
    document.addEventListener('click', (e) => {
      if (
        !searchInput.contains(e.target) &&
        !resultsContainer.contains(e.target)
      ) {
        resultsContainer.classList.remove('active');
        resultsContainer.style.display = 'none';
      }
    });
  }
</script>

</body>
</html>
